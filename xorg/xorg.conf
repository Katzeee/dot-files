# nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 515.43.04

# This section indicates the whole layout 
Section "ServerLayout"
    Identifier     "Layout0" # whatever you want
   Option	   "AllowNVIDIAGPUScreens"
    # 3840 1000 is used to set the position of this screen when setting TWO screens and TWO monitors
    #Screen      0  "Screen0"  3840 1000  # dual screen set cordinate, 0 0 means top left

    # If you put two `screen` over this section but don't start a GUI application like dwm or kde desktop by .xinitrc or command, you will get a black screen with a 'x' cursor on it but can do nothing.
    # Follow the instruction of xorg wiki, we can start a GUI application on other screens by `$ DISPLAY=:0.1 dwm` which means set env varible `$DISPLAY` equals to `:0.1`(:0.0 means the main screen, :0.1 means the second...), and then launch dwm.

    Screen	   "Screen1"  0 0

    # I don't know the use of the following two lines so far, so I commented them.
    #InputDevice    "Keyboard0" "CoreKeyboard"
    #InputDevice    "Mouse0" "CorePointer"
EndSection

# I don't know the use of it.
Section "Files"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Mouse0"
    Driver         "mouse"
    Option         "Protocol" "auto"
    Option         "Device" "/dev/psaux"
    Option         "Emulate3Buttons" "no"
    Option         "ZAxisMapping" "4 5"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Keyboard0"
    Driver         "kbd"
EndSection

# Device section is to set the graphic cards
Section "Device"
    Identifier     "Device0" # whatever you like
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    # Get BusID by `lspci -v | grep -A1 -e VGA -e 3D`.
    # 01:00.0 VGA compatible controller: NVIDIA Corporation GA107BM [GeForce RTX 3050 Mobile] (rev a1) (prog-if 00 [VGA controller]) 
    #   Subsystem: Lenovo Device 3e8c 
    # Above means "PCI:1:0:0"
    BusID          "PCI:1:0:0"
    Option "Accel"
    Option "RenderAccel"
    Option "NoFlip" "no"
    Option "SWCursor" "no"
    Option "HWCursor" "yes"
    Option "DamageEvents"
    Option "ModeDebug" "no"
    Option "AllowSHMPixmaps" "no" 
    Option "SidebandSocketPath" "/tmp"
    Option "UseSysmemPixmapAccel"
    Option "MultisampleCompatibility"
    Option "AllowEmptyInitialConfiguration"
    Option "ForceCompositionPipeline"
    Option "ForceFullCompositionPipeline"
    Option "AllowIndirectGLXProtocol" "no"
    Option "TripleBuffer"
    Option "Stereo" "0"
    Option "BaseMosaic" "no"
    Option "MultiGPU" "no"
    Option "SLI" "no"
    Option "PrimaryGPU" "yes"
    # only nvidia
    Option	   "Monitor-DP-4" "laptop" #! IMPORTANT: Used to attach output `DP-4` to this Device and name it as `laptop`, you will need this when using hybird graphic card
    Option	   "Monitor-HDMI-0" "Philips" #! You can determine which card is used to render the output by this option, `HDMI-0` or `DP-4` is the output of command `xrandr`
    #! For some kind of laptop, you need to shutdown the intel card phyiscally in bios or use applications, or you cannot use nvidia card to render the screen of your laptop
    # intel + nvidia
    Option	   "Monitor-HDMI-1-0" "Philips"
EndSection

Section "Device"
    Identifier     "iGPU"
    Driver         "modesetting"
    BusID          "PCI:0:2:0"
    Option	   "Monitor-eDP-1" "laptop"
    Option	   "TearFree" "on"
    Option	   "AccelMethod" "glamor"
    Option	   "DRI" "3"
EndSection


# set the attribute of the monitor
Section "Monitor"
    Identifier     "laptop" #! The same as the Device section
    Option	   "PreferredMode" "1920x1080"
    Option	   "Position" "3840 1000" # Be used to set the position of this monitor when setting ONE screen but TWO monitors, but I failed using this Option. 
    VendorName     "Unknown"
    ModelName      "Unknown"
    Option         "DPMS"
EndSection

Section "Monitor"
    Identifier     "Philips"
    Option	   "PreferredMode" "3840x2160"
    # cordinate for dual monitor in one screen 
    Option	   "Position" "0 0"
    VendorName     "Unknown"
    ModelName      "Unknown"
    Option         "DPMS"
EndSection


Section "Screen"
    Identifier     "Screen0"
    Device         "iGPU"
    Monitor        "laptop"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
    EndSubSection
EndSection

Section "Screen"
    Identifier     "Screen1"
    Device         "Device0"
    # Even for dual monitor, here only list one, I don't know why
    Monitor        "Philips"
    #! This works for me to set the position of two monitors
    Option         "metamodes" "DP-4: nvidia-auto-select +3840+1551, HDMI-0: nvidia-auto-select +0+0"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
    # Perhaps this is for intel driver
    #	Virtual     5760 2160
    EndSubSection
EndSection

